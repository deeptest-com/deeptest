<div class="execution-result">

  <div *ngIf="!model.id" class="row">
    <form [formGroup]="form" class="my-validate-form">
      <div class="form-group row">
        <div class="result-button col-sm-8">
          <div *ngIf="model.childrenCount" class="module-tips">
            <div class="row header">用例类型：</div>

            <div *ngIf="model.childrenCount.functional" class="row">
              <label class="col-sm-2">功能</label>
              <div class="col-sm-10">{{model.childrenCount.functional}}个</div>
            </div>
            <div *ngIf="model.childrenCount.performance" class="row">
              <label class="col-sm-2">性能</label>
              <div class="col-sm-10">{{model.childrenCount.performance}}个</div>
            </div>
            <div *ngIf="model.childrenCount.security" class="row">
              <label class="col-sm-2">安全</label>
              <div class="col-sm-10">{{model.childrenCount.security}}个</div>
            </div>
            <div *ngIf="model.childrenCount.others" class="row">
              <label class="col-sm-2">其他</label>
              <div class="col-sm-10">{{model.childrenCount.others}}个</div>
            </div>
          </div>

          <div *ngIf="model.childrenCount" class="module-tips">
            <div class="row header">执行状态：</div>

            <div *ngIf="model.childrenCount.untest" class="row">
              <label class="col-sm-2">未执行</label>
              <div class="col-sm-10">{{model.childrenCount.untest}}个</div>
            </div>
            <div *ngIf="model.childrenCount.pass" class="row">
              <label class="col-sm-2">通过</label>
              <div class="col-sm-10">{{model.childrenCount.pass}}个</div>
            </div>
            <div *ngIf="model.childrenCount.fail" class="row">
              <label class="col-sm-2">失败</label>
              <div class="col-sm-10">{{model.childrenCount.fail}}个</div>
            </div>
            <div *ngIf="model.childrenCount.block" class="row">
              <label class="col-sm-2">阻塞</label>
              <div class="col-sm-10">{{model.childrenCount.block}}个</div>
            </div>
          </div>
        </div>
        <div class="result-button col-sm-4">
          <button (click)="returnTo()" type="button"
                  class="button-right btn btn-primary btn-with-icon btn-sm back">
            <i class="fa fa-arrow-circle-left"></i>返回
          </button>
        </div>
      </div>
    </form>
  </div>

  <div *ngIf="model.id" class="row">
    <form [formGroup]="form" (ngSubmit)="save()" class="my-validate-form">
      <div class="form-group row">
        <div class="result-button col-sm-12">
          <button *ngIf="canExe" (click)="setResult('pass')" type="button" class="btn btn-primary btn-sm">通过</button>
          <button *ngIf="canExe" (click)="setResult('fail')" type="button" class="btn btn-danger btn-sm">失败</button>
          <button *ngIf="canExe" (click)="setResult('block')" type="button" class="btn btn-warning btn-sm">阻塞</button>

          <label *ngIf="canExe" class="col-form-label form-check-label">
            <input [(ngModel)]="next" formControlName="next" name="next"
                   class="form-check-input form-control-lg" type="checkbox" value="true">同时转到下一个
          </label>

          <button (click)="returnTo()" type="button"
                  class="button-right btn btn-primary btn-with-icon btn-sm back">
            <i class="fa fa-arrow-circle-left"></i>返回
          </button>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-12">
          <field-show [readonly]="!canEdit" (onSave)="saveField($event)" [(model)]="model" [prop]="'name'" [type]="'string'" [required]="true"></field-show>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-12">

          <div class="tabs-container light">
            <div class="tabs">
              <ngb-tabset  (tabChange)="tabChange($event)">
                <ngb-tab id="info">
                  <ng-template ngbTabTitle>信息</ng-template>
                  <ng-template ngbTabContent></ng-template>
                </ngb-tab>
                <ngb-tab id="result">
                  <ng-template ngbTabTitle>结果</ng-template>
                  <ng-template ngbTabContent></ng-template>
                </ngb-tab>
                <!--<ngb-tab id="history">
                  <ng-template ngbTabTitle>历史</ng-template>
                  <ng-template ngbTabContent></ng-template>
                </ngb-tab>-->
              </ngb-tabset>
            </div>
          </div>

        </div>
      </div>

      <div [class.hidden]="tab != 'info'">

        <div class="row">
          <div class="col-sm-12 property">
          <table class="io">
            <tbody>
              <tr>
                <td style="width: 25%">
                  <div class="label">状态</div>
                  <field-show (onSave)="saveField($event)" [(model)]="model" [prop]="'status'" [type]="'string'" optionsKey="status"
                              [required]="true" [readonly]="true"></field-show>
                </td>

                <td style="width: 25%">
                  <div class="label">类型</div>
                  <field-show (onSave)="saveField($event)" [(model)]="model" [prop]="'type'" [type]="'dropdown'" optionsKey="type"
                              [required]="true" [readonly]="!canEdit"></field-show>
                </td>
                <td style="width: 25%">
                  <div class="label">优先级</div>
                  <field-show (onSave)="saveField($event)" [(model)]="model" [prop]="'priority'" [type]="'dropdown'" optionsKey="priority"
                              [required]="true" [readonly]="!canEdit"></field-show>
                </td>
                <td style="width: 25%">
                  <div class="label">耗时(分钟)</div>
                  <div class="value">
                    <field-show (onSave)="saveField($event)" [(model)]="model" [prop]="'estimate'" [type]="'number'"
                                [required]="true" [readonly]="!canEdit"></field-show>
                  </div>
                </td>
              </tr>
            <tr>
            </tr>
            </tbody>
          </table>
          </div>
      </div>

      <div class="row field-show-container">
        <div class="col-sm-12">
          <field-show (onSave)="saveField($event)" [(model)]="model" [readonly]="!canEdit"
                      [label]="'目标'" [prop]="'objective'" [type]="'string'"></field-show>
        </div>
      </div>

      <div *ngFor="let field of fields;" class="row field-show-container">
        <div class="col-sm-12">
          <field-show (onSave)="saveField($event)" [(model)]="model" [readonly]="!canEdit"
                      [label]="field.label" [prop]="field.myColumn" [type]="field.type" [field]="field"
                      [format]="field.format" [rows]="field.rows" [required]="field.isRequired"></field-show>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-10">
          <div class="tabs-container light">
            <div class="tabs">
              <ngb-tabset>
                <ngb-tab id="content">
                  <ng-template ngbTabTitle>测试步骤</ng-template>
                  <ng-template ngbTabContent></ng-template>
                </ngb-tab>
              </ngb-tabset>
            </div>
          </div>
        </div>
        <div *ngIf="canEdit" class="contentType col-sm-2">
          <span *ngIf="model.contentType=='richText'" (click)="changeContentType('steps')" class="link">
            <i class="fa fa-th"></i>
            切换到表格
          </span>
            <span *ngIf="model.contentType=='steps'" (click)="changeContentType('richText')" class="link">
            <i class="fa fa-file-text-o"></i>
              切换到富文本
          </span>
        </div>
      </div>
      <div class="tab-steps form-group row">
        <div class="col-sm-12">
          <div *ngIf="'steps'==model.contentType">
            <steps-table [settings]="settings"
                         [source]="model.steps"
                         (upConfirm)="onUpConfirm($event)"
                         (downConfirm)="onDownConfirm($event)"

                         (createConfirm)="onCreateConfirm($event)"
                         (saveConfirm)="onSaveConfirm($event)"
                         (deleteConfirm)="onDeleteConfirm($event)"
            ></steps-table>
          </div>
          <div *ngIf="'richText'==model.contentType">
            <field-show (onSave)="saveField($event)" [(model)]="model" [readonly]="!canEdit"
                        [label]="'操作'" [prop]="'content'" [type]="'text'" [format]="model.contentType"></field-show>
          </div>
        </div>
      </div>
    </div>

    <div [class.hidden]="tab != 'result'" class="tab-summary">
      <div class="form-group row">
        <label class="col-sm-1 col-form-label"><span>实际<br/>结果</span></label>
        <div *ngIf="canExe" class="col-sm-11">
            <textarea type="text" class="form-control" name="result" formControlName="result"
                      [(ngModel)]="model.result" #result></textarea>
        </div>
        <label *ngIf="!canExe" class="col-sm-11 col-form-label">
            {{model.result}}
        </label>
      </div>
    </div>

    <div [class.hidden]="tab != 'history'" class="tab-summary">
      TODO
    </div>

      <comment-list [model]="model"></comment-list>

    <div class="form-group row">
      <label class="col-sm-2 col-form-label"></label>
      <div class="col-sm-10">
        <div class="validate-errors">
          <div class="validate-error" *ngFor="let msg of formErrors">
            <div>{{ msg }}</div>
          </div>
        </div>
      </div>
    </div>

    </form>
  </div>

</div>
